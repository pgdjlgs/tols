#!/bin/bash
# grubtheme v0.2 - Smart Detection Mode
# Developed by pgdjlgs

VERSION="0.2"
THEMES_DIR="/boot/grub/themes"

echo "--- grubtheme v$VERSION ---"

# دالة البحث الذكي
smart_search() {
    echo "إدخال فارغ.. جاري تفعيل البحث الذكي عن أفضل دقة..."
    
    # البحث عن المجلدات التي تحتوي على ملف الإعدادات
    mapfile -t found_themes < <(find . -name "theme.txt" -exec dirname {} \;)

    if [ ${#found_themes[@]} -eq 0 ]; then
        echo "خطأ: لم يتم العثور على أي ثيم صالح (theme.txt مفقود)."
        exit 1
    fi

    # محاولة اختيار مجلد 1080p أو المجلد الذي يحتوي على كلمة background
    best_match=$(printf '%s\n' "${found_themes[@]}" | grep -E "1080p|FullHD|background" | head -n 1)

    # إذا لم يجد كلمات دالة، يختار أول مجلد يحتوي على theme.txt
    if [ -z "$best_match" ]; then
        best_match="${found_themes[0]}"
    fi

    echo "تم اختيار المسار الأنسب تلقائياً: $best_match"
    SELECTED_THEME_PATH="$best_match"
}

# الطلب من المستخدم
read -p "أدخل اسم مجلد الثيم أو اضغط Enter للبحث الذكي: " user_input

if [ -z "$user_input" ]; then
    smart_search
else
    SELECTED_THEME_PATH="./$user_input"
fi

# فحص نهائي وتطبيق الثيم (المنطق الأساسي)
if [ -d "$SELECTED_THEME_PATH" ]; then
    echo "جاري تطبيق الثيم من $SELECTED_THEME_PATH..."
    # هنا تضع أوامر النسخ وتعديل ملف /etc/default/grub
    # sudo cp -r "$SELECTED_THEME_PATH" "$THEMES_DIR/"
    # ... إلخ
else
    echo "خطأ: المجلد غير موجود."
fi
